Options -Indexes -MultiViews +FollowSymlinks
AddDefaultCharset UTF-8
SetEnv TZ Europe/Berlin
Header always set Strict-Transport-Security "max-age=10886400; includeSubDomains; preload" env=HTTPS
Header set Connection keep-alive

<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteBase /

	RewriteCond %{HTTPS} !=on
	RewriteCond %{HTTP_HOST} ^(www.)?mr42.me [NC,OR]
	RewriteCond %{HTTP_HOST} ^(.+?).mister42.me [NC]
	RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [R=301,L]

	Rewritecond %{HTTP_HOST} !^mr42.me [NC]
	RewriteCond %{HTTP_HOST} ^[^.]+\.[^.]+$
	RewriteRule ^(.*)$ %{REQUEST_SCHEME}://www.%{HTTP_HOST}/$1 [R=301,L]

	Redirect 301 /lyrics /music/lyrics
	RedirectMatch 301 ^/(de|en|ru)/lyrics$ /$1/music/lyrics
	RedirectMatch 301 ^/(raspberry)?pi$ /my/pi
	RedirectMatch 301 ^/(de|en|ru)/(raspberry)?pi$ /$1/my/pi
	RedirectMatch 301 ^/contact$ /my/contact
	RedirectMatch 301 ^/(de|en|ru)/contact$ /$1/my/contact

	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_FILENAME} !-d
	RewriteRule . index.php

	RewriteCond %{THE_REQUEST} ^GET.*index.php [NC]
	RewriteRule (.*?)index.php/*(.*) /$1$2 [R=301,NE,L]
</IfModule>

# Caching
FileETag All

<IfModule mod_headers.c>
	<FilesMatch "\.(ico)$">
		Header set Cache-Control "max-age=900, private, must-revalidate"
	</FilesMatch>

	# Make sure proxies don't deliver the wrong content
	Header append Vary User-Agent env=!dont-vary
</IfModule>

# Compression
SetOutputFilter DEFLATE

# Don't compress images
SetEnvIfNoCase Request_URI .(?:jpe?g|png|gif)$ no-gzip dont-vary

# Don't compress binaries
SetEnvIfNoCase Request_URI .(?:exe|t?gz2?|zip|sit|rar)$ no-gzip dont-vary
